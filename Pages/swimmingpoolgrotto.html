<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Potree Viewer</title>

    <link rel="stylesheet" type="text/css" href="../build/potree/potree.css">
    <link rel="stylesheet" type="text/css" href="../libs/jquery-ui/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="../libs/perfect-scrollbar/css/perfect-scrollbar.css">
    <link rel="stylesheet" type="text/css" href="../libs/openlayers3/ol.css">
    <link rel="stylesheet" type="text/css" href="../libs/spectrum/spectrum.css">
    <link rel="stylesheet" type="text/css" href="../libs/jstree/themes/mixed/style.css">
    <link rel="stylesheet" type="text/css" href="../libs/font-awesome/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../libs/font-awesome/font-awesome.css">
    <!-- Custom styles for this template -->
    <link rel="stylesheet" type="text/css" href="../assets/css/vizcaya.css">
    <style>
        body {
            background-color: black !important;
        }

        .potree_container {
            position: absolute;
            width: 100%;
            height: 100%;
            left: 0px;
            top: 0px;
        }
        /*
        * Scrollbar for hotspot controls
        */
        ::-webkit-scrollbar {
            width: 9px;
        }

        ::-webkit-scrollbar-button {
            width: 8px;
            height: 2px;
        }

        ::-webkit-scrollbar-track {
            background: black;
            border: thin solid black;
            box-shadow: 0px 0px 3px black inset;
            border-radius: 12px;
        }

        ::-webkit-scrollbar-thumb {
            background: #565656;
            border: thin solid #565656;
            border-radius: 12px;
        }

            ::-webkit-scrollbar-thumb:hover {
                background: #7d7d7d;
            } 

    </style>
</head>

<body>
    <script src="../libs/jquery/jquery-3.1.1.min.js"></script>
    <script src="../libs/spectrum/spectrum.js"></script>
    <script src="../libs/perfect-scrollbar/js/perfect-scrollbar.jquery.js"></script>
    <script src="../libs/jquery-ui/jquery-ui.min.js"></script>
    <script src="../libs/three.js/build/three.min.js"></script>
    <script src="../libs/other/BinaryHeap.js"></script>
    <script src="../libs/tween/tween.min.js"></script>
    <script src="../libs/d3/d3.js"></script>
    <script src="../libs/proj4/proj4.js"></script>
    <script src="../libs/openlayers3/ol.js"></script>
    <script src="../libs/i18next/i18next.js"></script>
    <script src="../libs/jstree/jstree.js"></script>
    <script src="../build/potree/potree.js"></script>
    <script src="../libs/plasio/js/laslaz.js"></script>
    <script src="../libs2/other/OrbitControls.js"></script>
    <script src="../main.js"></script>
    <!-- INCLUDE ADDITIONAL DEPENDENCIES HERE -->
    <!-- INCLUDE SETTINGS HERE -->

    <div class="potree_container">
        <div id="potree_render_area"></div>
        <div id="potree_sidebar_container"> </div>

        <img id="question_icon" src="../images/question.svg" title="Navigation" />
        <img id="refresh_icon" onclick="refreshButton()" src="../images/refresh.svg" title="Refresh Page" />
<!--
        <img id="control_icon" src="../images/arrows.svg" title="Access Control Panel" />
-->
        <img id="fullscreen_icon" onclick="toggleFullScreen()" src="../images/fullscreen.svg" title="Fullscreen" />

        <div>
            <img id="control_panel" src="../images/Control_Panel.png" usemap="#controlPanel" />
            <map name="controlPanel">

                <!--Reset Button-->
                <area shape="circle" coords="50,55,20,10" onclick="redirectFunc()" />
                <!--Home Button-->
                <area shape="circle" coords="170,55,20,10" onclick="redirectHomeFunc()" />
                <!--Up Button-->
                <area shape="circle" coords="110,62,25,10" onclick="moveUp()" />
                <!--Down Button-->
                <area shape="circle" coords="110,140,25,10" onclick="moveDown()" />
                <!--left Button-->
                <area shape="circle" coords="70,105,20,10" onclick="moveLeft()" />
                <!--Right Button-->
                <area shape="circle" coords="150,105,20,10" onclick="moveRight()" />
                <!--Zoom In-->
                <area shape="circle" coords="50,160,20,10" onclick="zoomIn()" />
                <!--Zoom Out-->
                <area shape="circle" coords="170,160,20,10" onclick="zoomOut()" />
            </map>
        </div>

        <!-- navPanel 1 -->
        <div id="nav_panel" class="navPanel">
            <div class="navPanel-content">
                <div class="intrinsic-container intrinsic-container-16x9">
                    <img class="nav_img" src="../images/navigation.png" />
                </div>
            </div>
        </div>
        <!--
    <div id="nav_panel" class="navPanel">
        <div class="navPanel-content">
            <span id="navClose" class="close">&times;</span>
            <div class="intrinsic-container intrinsic-container-16x9">
                <img class="nav_img" src="../images/navigation.png"/>
            </div>
        </div>
    </div>
    -->
        <!--HOTSPOT CONTROLS-->
        <div class="controls">
            <div class="hotspot-controls">
                <div id="prev" data-title="Previous Annotation" data-action="prev-annotation">
                    <div class="icon fa fa-caret-left"></div>
                </div>
                <div id="hotspots" class="hotspot-name" data-action="toggle-annotation-list">Select a point of interest</div>
                <div id="next" data-title="Next Annotation" data-action="next-annotation">
                    <div class="icon fa fa-caret-right"></div>
                </div>
                <div id="lists" class="list hotspots-list visible">
                    <!--
                                    <a href="#" data-action="toggle-visibility" class="annotations-visibility"></a>
                                    <a href="#" data-action="toggle-autopilot" class="annotations-autopilot"></a>
                -->
                    <ul class="js-scrollable">
                        <li id="li1" class="link"><a data-hotspot-target="0" title="Amorino"><span class="index">1</span> Amorino</a></li>
                        <li id="li2" class="link"><a data-hotspot-target="1" title="Ceiling Mural"><span class="index">2</span>Ceiling Mural</a></li>
                        <li id="li3" class="link"><a data-hotspot-target="2" title="Hudson River Sturgeons"><span class="index">3</span> Hudson River Sturgeons</a></li>
                        <li id="li4" class="link"><a data-hotspot-target="3" title="Fountains"><span class="index">4</span>Fountains</a></li>
                        <li id="li5" class="link"><a data-hotspot-target="4" title="Floor"><span class="index">5</span> Floor</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <!--END OF HOTSPOT CONTROLS-->



        <script>
            //Navigation Panel
            var navPanel = document.getElementById('nav_panel');
            navPanel.addEventListener('click', function () {
                navPanel.style.display = "none";
            });

            /*
            $("#navClose").click(function () {
                navPanel.style.display = "none";
            });

            //Navigation Panel

            function navPanelClose(event) {
                var navPanel = document.getElementsByClassName('nav_panel');
                var span = document.getElementsByClassName("close")[0];

                span.onclick = function () {
                    navPanel.style.display = "none";
                }

                window.onclick = function (event) {
                    if (event.target == navPanel) {
                        navPanel.style.display = "none";
                    }
                }
            }
            */

            $("#control_icon").click(function () {

                $("#control_panel").toggle();
            });

            $("#question_icon").click(function () {

                $("#nav_panel").toggle();
            });

            setup();
            window.viewer = new Potree.Viewer(document.getElementById("potree_render_area"));


            viewer.setEDLEnabled(false);
            viewer.setFOV(60);

            viewer.setPointBudget(5 * 1000 * 1000);
            document.title = "";
            viewer.setEDLEnabled(false);
            viewer.setBackground("gradient"); // ["skybox", "gradient", "black", "white"];
            viewer.loadSettingsFromURL();

            viewer.loadGUI(() => {
                viewer.setLanguage('en');
                $("#menu_scene").next().show();
                //     viewer.toggleSidebar();
            });

            viewer.setDescription(`

                                                                        `);

            let sceneSG = new Potree.Scene();
            let sceneSG2 = new Potree.Scene();
            let sceneSG3 = new Potree.Scene();
            let sceneLion = new Potree.Scene();
            viewer.setScene(sceneSG);

            function getParam(paramName) {
                var src = document.referrer;
                var srcSplit = src.split("?");
                var address = srcSplit[1];
                var paramArray = address.split('&');
                //var paramList = window.location.search.substring(1);
                //var paramArray = paramList.split('&');
                for (var i = 0; i < paramArray.length; i++) {
                    var pArr = paramArray[i].split('=');
                    if (pArr[0] == paramName)
                        return pArr[1];
                }
            }

            var x_position = parseFloat(getParam('xP'));
            var y_position = parseFloat(getParam('yP'));
            var z_position = parseFloat(getParam('zP'));

            var x_lookAt = parseFloat(getParam('xL'));
            var y_lookAt = parseFloat(getParam('yL'));
            var z_lookAt = parseFloat(getParam('zL'));


            Potree.loadPointCloud("https://s3.amazonaws.com/vizcaya/pointclouds/grotto/cloud.js", "swimmingpoolgrotto", function (e) {

                sceneSG.addPointCloud(e.pointcloud);
                sceneSG.view.position.set(x_position, y_position, z_position);
                sceneSG.view.lookAt(new THREE.Vector3(x_lookAt, y_lookAt, z_lookAt));


                let material = e.pointcloud.material;
                material.size = 1;
                material.pointSizeType = Potree.PointSizeType.ADAPTIVE;

                {
                    // AMORINO
                    {
                        let elTitle = $(`
                            <span>
                                <img src="${Potree.resourcePath}/icons/i.png"
                                    name="action_set_scene"
                                    class="annotation-action-icon"
                                    style="filter: invert(1);" />
                            </span>
                                                                                `);
                        elTitle.find("img[name=action_set_scene]").click((event) => {
                        });
                        elTitle.toString = () => "AMORINO";

                        let aAbout1 = new Potree.Annotation({
                            position: [-30.790, 1.353, -2.003],
                            title: elTitle,
                            cameraPosition: [-30.289, 2.205, -1.767],
                            cameraTarget: [-31.354, 1.411, -1.882],
                            description: `AMORINO<hr>This sculpture, cast in lead, was always intended to be a fountain for this grotto, though it no longer
                                                                                        functions in this way. It has survived flooding from multiple storms because lead generally resists corrosion, and
                                                                                        when exposed, the surface develops a protective, grey patina as seen here.
                                                                                        `
                        });

                        sceneSG.annotations.add(aAbout1);
                    }

                    // CEILING
                    {
                        let elTitle = $(`
                            <span>
                                <img src="${Potree.resourcePath}/icons/i.png"
                                    name="action_set_scene"
                                    class="annotation-action-icon"
                                    style="filter: invert(1);" />
                            </span>
                                                                                `);
                        elTitle.find("img[name=action_set_scene]").click((event) => {
                        });
                        elTitle.toString = () => "CEILING MURAL";

                        let aAbout2 = new Potree.Annotation({
                            position: [-30.638, 0.476, 0.405],
                            title: elTitle,
                            cameraPosition: [-27.114, 1.190, -2.820],
                            cameraTarget: [-31.292, 2.889, 1.065],
                            description: `CEILING MURAL<hr>The sculptural mural that decorates the vaulted ceiling depicts a marine fantasy framed with molded
                                                                                        plaster shells and coral. Look out for sea turtles, seahorses, octopi, alligators and fish. The original colors
                                                                                        of the ceiling are now faded and difficult to identify.
                                                                                        `
                        });

                        sceneSG.annotations.add(aAbout2);
                    }

                    //STURGEON
                    {
                        let elTitle = $(`
                                                            <span>
                                                                <img src="${Potree.resourcePath}/icons/i.png"
                                                                    name="action_set_scene"
                                                                    class="annotation-action-icon"
                                                                    style="filter: invert(1);" />
                                                            </span>
                                                                                `);
                        elTitle.find("img[name=action_set_scene]").click((event) => {
                        });
                        elTitle.toString = () => "HUDSON RIVER STURGEONS";

                        let aAbout3 = new Potree.Annotation({
                            position: [-27.864, 2.535, 0.135],
                            title: elTitle,
                            cameraPosition: [-28.826, 1.887, -3.110],
                            cameraTarget: [-28.826, 1.887, 0.219],
                            description: `HUDSON RIVER STURGEONS<hr>Originally, nearly all the fish were covered with metallic paint, now buried beneath several layers of
                                                                                        new non-metallic paint used by former museum staff in attempts to preserve the mural. The use of metallic was
                                                                                        intended to mimic the iridescence of fish scales glimmering in the water and to create an immersive experience for
                                                                                        Deering’s guests.
                                                                                        `
                        });

                        sceneSG.annotations.add(aAbout3);
                    }

                    //FOUNTAINS
                    {
                        let elTitle = $(`
                                                            <span>
                                                                <img src="${Potree.resourcePath}/icons/i.png"
                                                                    name="action_set_scene"
                                                                    class="annotation-action-icon"
                                                                    style="filter: invert(1);" />
                                                            </span>
                                                                                `);
                        elTitle.find("img[name=action_set_scene]").click((event) => {
                        });
                        elTitle.toString = () => "FOUNTAINS";

                        let aAbout4 = new Potree.Annotation({
                            position: [-26.413, -0.618, -1.323],
                            title: elTitle,
                            cameraPosition: [-27.815, 2.041, -1.450],
                            cameraTarget: [-25.942, 0.084, -1.567],
                            description: `FOUNTAINS<hr>These coral rock fountains are similar to some of the other fountains found throughout the gardens at
                                                                                        Vizcaya. Vizcaya has learned that restoration of the fountains can help moderate the high levels of humidity in
                                                                                        the space and better protect the collection of objects in the Swimming Pool Grotto.
                                                                                        `
                        });

                        sceneSG.annotations.add(aAbout4);
                    }

                    //FLOOR
                    {
                        let elTitle = $(`
                                                            <span>
                                                                <img src="${Potree.resourcePath}/icons/i.png"
                                                                    name="action_set_scene"
                                                                    class="annotation-action-icon"
                                                                    style="filter: invert(1);" />
                                                            </span>
                                                                                `);
                        elTitle.find("img[name=action_set_scene]").click((event) => {
                        });
                        elTitle.toString = () => "FLOOR";

                        let aAbout5 = new Potree.Annotation({
                            position: [-29.326, -2.261, -2.682],
                            title: elTitle,
                            cameraPosition: [-35.020, 3.368, -1.354],
                            cameraTarget: [-33.436, 1.582, -2.699],
                            description: `FLOOR<hr>Like those inside the house, the marble floor is made of rare imported stones, carefully cut and laid in
                                                                                        an intricate pattern.
                                                                                        `
                        });

                        sceneSG.annotations.add(aAbout5);
                    }
                }
            });

            var timeoutID;

            function setup() {
                this.addEventListener("mousemove", resetTimer, false);
                this.addEventListener("touchstart", resetTimer, false);
                this.addEventListener("mousedown", resetTimer, false);
                this.addEventListener("mouseover", resetTimer, false);
                this.addEventListener("mouseout", resetTimer, false);
                this.addEventListener("keypress", resetTimer, false);
                this.addEventListener("DOMMouseScroll", resetTimer, false);
                this.addEventListener("mousewheel", resetTimer, false);
                this.addEventListener("touchmove", resetTimer, false);
                this.addEventListener("MSPointerMove", resetTimer, false);

                startTimer();
            }

            function startTimer() {

                timeoutID = window.setTimeout(goInactive, 300000);
            }

            function resetTimer(e) {
                window.clearTimeout(timeoutID);

                goActive();
            }

            function goInactive() {

                window.top.location.href = "../index.html";
            }

            function goActive() {


                startTimer();
            }

            /*
             * HOTSPOT CONTROLS FUNCTIONS
            */

            $("#hotspots").click(function () {
                $("#lists").toggle();
            });

            //Functions for each annotation
            function item1() {
                let scene = viewer.scene;
                scene.view.position.set(-30.289, 2.205, -1.767);
                scene.view.lookAt(new THREE.Vector3(-31.354, 1.411, -1.882));
            }

            function item2() {
                let scene = viewer.scene;
                scene.view.position.set(-27.002, 0.944, -2.493);
                scene.view.lookAt(new THREE.Vector3(-31.510, 3.114, 0.732));
            }
            function item3() {
                let scene = viewer.scene;
                scene.view.position.set(-28.826, 1.887, -3.110);
                scene.view.lookAt(new THREE.Vector3(-28.826, 1.887, 0.219));

            }
            function item4() {
                let scene = viewer.scene;
                scene.view.position.set(-27.815, 2.041, -1.450);
                scene.view.lookAt(new THREE.Vector3(-25.942, 0.084, -1.567));
            }
            function item5() {
                let scene = viewer.scene;
                scene.view.position.set(-35.020, 3.368, -1.354);
                scene.view.lookAt(new THREE.Vector3(-33.436, 1.582, -2.699));
            }

            //Click functions for each annotation within Hotspot Control's List

            $("#li1").click(function () {
                item1();
            });
            $("#li2").click(function () {
                item2();
            });
            $("#li3").click(function () {
                item3();
            });
            $("#li4").click(function () {
                item4();
            });
            $("#li5").click(function () {
                item5();
            });

            //Functions for continuous click on Prev and Next buttons
            const functions = [];
            functions.push(item1);
            functions.push(item2);
            functions.push(item3);
            functions.push(item4);
            functions.push(item5);

            const length = functions.length;

            const getNextIdx = (idx = 0, length, direction) => {
                switch (direction) {
                    case 'next': return (idx + 1) % length;
                    case 'prev': return (idx == 0) && length - 1 || idx - 1;
                    default: return idx;
                }
            }

            let idx; // idx is undefined, so getNewScene will take 0 as default
            const getNewScene = (direction) => {
                idx = getNextIdx(idx, length, direction);
                var sceneFunction = functions[idx];
                return sceneFunction();
            }

            $("#prev").click(function () {
                getNewScene('prev');
            });

            $("#next").click(function () {
                getNewScene('next');
            });

                                            /*
                                             * END OF HOTSPOT CONTROLS FUNCTIONS
                                            */

        </script>


</body>
</html>
