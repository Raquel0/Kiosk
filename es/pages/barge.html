<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Potree Viewer</title>

    <link rel="stylesheet" type="text/css" href="../build/potree/potree.css">
    <link rel="stylesheet" type="text/css" href="../libs/jquery-ui/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="../libs/perfect-scrollbar/css/perfect-scrollbar.css">
    <link rel="stylesheet" type="text/css" href="../libs/openlayers3/ol.css">
    <link rel="stylesheet" type="text/css" href="../libs/spectrum/spectrum.css">
    <link rel="stylesheet" type="text/css" href="../libs/jstree/themes/mixed/style.css">\
    <link href="https://fonts.googleapis.com/css?family=Marcellus" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <style>


        #fullscreen_icon {
            max-width: 40px;
            max-height: 40px;
            width: 100%;
            height: 100%;
            position: fixed;
            bottom: 15px;
            right: 10px;
            z-index: 100;
            cursor: pointer;
        }

        #handicap_icon {
            max-width: 50px;
            max-height: 50px;
            width: 100%;
            height: 100%;
            position: fixed;
            bottom: 15px;
            right: 70px;
            z-index: 100;
            cursor: pointer;
        }

        #control_panel {
            max-width: 300px;
            max-height: 300px;
            width: auto;
            height: auto;
            position: fixed;
            bottom: 100px;
            right: 70px;
            z-index: 100;
            display:none;
        }

        #refresh_icon {
            max-width: 50px;
            max-height: 50px;
            width: 100%;
            height: 100%;
            position: fixed;
            bottom: 15px;
            right: 140px;
            z-index: 100;
            cursor: pointer;
        }

        .annotation-description {
            position: relative;
            color: white;
            background-color: black;
            padding: 10px;
            margin: 5px 0px 0px 0px;
            border-radius: 4px;
            display: none;
            max-width: 430px;
            width: 500px;
            font-size: 1em;
            font-family: 'Open Sans', sans-serif;
        }
    </style>
</head>

<body>
	<script src="../libs/jquery/jquery-3.1.1.min.js"></script>
	<script src="../libs/spectrum/spectrum.js"></script>
	<script src="../libs/perfect-scrollbar/js/perfect-scrollbar.jquery.js"></script>
	<script src="../libs/jquery-ui/jquery-ui.min.js"></script>
	<script src="../libs/three.js/build/three.min.js"></script>
	<script src="../libs/other/BinaryHeap.js"></script>
	<script src="../libs/tween/tween.min.js"></script>
	<script src="../libs/d3/d3.js"></script>
	<script src="../libs/proj4/proj4.js"></script>
	<script src="../libs/openlayers3/ol.js"></script>
	<script src="../libs/i18next/i18next.js"></script>
	<script src="../libs/jstree/jstree.js"></script>
	<script src="../build/potree/potree.js"></script>
	<script src="../libs/plasio/js/laslaz.js"></script>
	<script src="../main.js"></script>
	<!-- INCLUDE ADDITIONAL DEPENDENCIES HERE -->
	<!-- INCLUDE SETTINGS HERE -->
	
    <div class="potree_container" style="position: absolute; width: 100%; height: 100%; left: 0px; top: 0px; ">
        <div id="potree_render_area"></div>
        <div id="potree_sidebar_container"> </div>

        <img id="refresh_icon" onclick="refreshButton()" src="../images/Refresh01.png" />
        <img id="fullscreen_icon" onclick="toggleFullScreen()" src="../images/Arrows_Icon02.png" title="Fullscreen" />
        <img id="handicap_icon" src="../images/Handicap_Icon.png" title="Help" />
        <div>

            <img id="control_panel" src="../images/Control_Panel.png" usemap="#controlPanel" />

            <map name="controlPanel">

                <!--Reset Button-->
                <area shape="circle" coords="50,55,20,10" onclick="redirectFunc()" />
                <!--Home Button-->
                <area shape="circle" coords="170,55,20,10" onclick="redirectHomeFunc()" />
                <!--Up Button-->
                <area shape="circle" coords="110,62,25,10" onclick="potreeMerMoveUp()" />
                <!--Down Button-->
                <area shape="circle" coords="110,140,25,10" onclick="potreeMerMoveDown()" />
                <!--left Button-->
                <area shape="circle" coords="70,105,20,10" onclick="potreeMerMoveLeft()" />
                <!--Right Button-->
                <area shape="circle" coords="150,105,20,10" onclick="potreeMerMoveRight()" />
                <!--Zoom In-->
                <area shape="circle" coords="50,160,20,10" onclick="zoomIn()" />
                <!--Zoom Out-->
                <area shape="circle" coords="170,160,20,10" onclick="zoomOut()" />
            </map>
        </div>
    </div>
	
	<script>

        $("#handicap_icon").click(function () {

            $("#control_panel").toggle();
        });
	
		window.viewer = new Potree.Viewer(document.getElementById("potree_render_area"));
		
		viewer.setEDLEnabled(false);
		viewer.setFOV(60);
		viewer.setPointBudget(5*1000*1000);
		document.title = "";
	
		viewer.setBackground("gradient"); // ["skybox", "gradient", "black", "white"];
		viewer.loadSettingsFromURL();

		viewer.loadGUI(() => {
			viewer.setLanguage('en');
			$("#menu_tools").next().show();
			//viewer.toggleSidebar();
		});

        viewer.setDescription(`
		
		`);

        let sceneSG = new Potree.Scene();
        let sceneSG2 = new Potree.Scene();
		let sceneSG3 = new Potree.Scene();
		let sceneLion = new Potree.Scene();
        viewer.setScene(sceneSG);

        function getParam(paramName) {
            var src = document.referrer;
            var srcSplit = src.split("?");
            var address = srcSplit[1];
            var paramArray = address.split('&');
            //var paramList = window.location.search.substring(1);
            //var paramArray = paramList.split('&');
            for (var i = 0; i < paramArray.length; i++) {
                var pArr = paramArray[i].split('=');
                if (pArr[0] == paramName)
                    return pArr[1];
            }
        }

        var x_position = parseFloat(getParam('xP'));
        var y_position = parseFloat(getParam('yP'));
        var z_position = parseFloat(getParam('zP'));

        var x_lookAt = parseFloat(getParam('xL'));
        var y_lookAt = parseFloat(getParam('yL'));
        var z_lookAt = parseFloat(getParam('zL'));

	Potree.loadPointCloud("https://s3.amazonaws.com/vizcaya/pointclouds/barge/cloud.js", "barge", function (e){ 
       
            sceneSG.addPointCloud(e.pointcloud);
            sceneSG.view.position.set(x_position, y_position, z_position);
            sceneSG.view.lookAt(new THREE.Vector3(x_lookAt, y_lookAt, z_lookAt));


            let material = e.pointcloud.material;
            material.size = 1;
            material.pointSizeType = Potree.PointSizeType.ADAPTIVE;


            {
                {
                    let elTitle = $(`
						<span>
							Herm
							<img src="${Potree.resourcePath}/icons/goto.svg" 
								name="action_set_scene"
								class="annotation-action-icon" 
								style="filter: invert(1);" />
						</span>
					`);
                    elTitle.find("img[name=action_set_scene]").click((event) => {
                        event.stopPropagation();
                        viewer.setScene(sceneSG2);
                    });
                    elTitle.toString = () => "HERM";

                    let aAbout1 = new Potree.Annotation({
                        position: [-45.632, -27.628, -0.686],
                        title: elTitle,
                        cameraPosition: [-47.033, -24.550, 0.708],
                        cameraTarget: [-44.035, -36.829, -1.740],
                        description: `Cuatro hermas (bustos sin brazos colocados sobre columnas) dan la bienvenida a los invitados de la Barcaza. Las cestas de bananas y piñas sobre la cabeza de cada herma representan los trópicos. Hoy en día es difícil distinguir los detalles de los hermas, e inclusive algunos elementos han desaparecido por completo. Durante el huracán Wilma en el 2005, el herma femenino al lado este de la Barcaza se cayó en la bahía. Un equipo de conservación lo devolvió a su lugar después de recuperar y restaurar la figura. Los vientos y las mareas producidos por el huracán Irma en el 2017 hicieron que otro herma femenino se rompiera en tres grandes pedazos. Los pedazos fueron recuperados de la bahía en el 2018, y el herma será devuelto a su lugar después de su restauración.`
                    });

                    sceneSG.annotations.add(aAbout1);
                }

				{
                    let elTitle = $(`
						<span>
							Pleasures and Perils
							<img src="${Potree.resourcePath}/icons/goto.svg" 
								name="action_set_scene"
								class="annotation-action-icon" 
								style="filter: invert(1);" />
						</span>
					`);
                    elTitle.find("img[name=action_set_scene]").click((event) => {
                        event.stopPropagation();
                        viewer.setScene(sceneLion);
                    });
                    elTitle.toString = () => "SCULPTURES";

                    let aAbout3 = new Potree.Annotation({
                        position: [-62.499, -50.734, 2.004],
                        title: elTitle,
                        cameraPosition: [-63.384, -51.399, 2.409],
                        cameraTarget: [-62.166, -50.460, 2.043],
                        description: `Estas criaturas míticas desnudas con características humanas y pez se encuentran rodeadas de motivos marítimos, como algas marinas y corales. Las figuras sentadas son reproducciones hechas en 1982.`
                    });

                    sceneSG.annotations.add(aAbout3);
                }
				
            //   {
//                    let aAbout2 = new Potree.Annotation({
//                        position: [-61.216, -49.492, 2.215],
//                        "cameraPosition": [-61.216, -49.492, 2.215],
//                        "cameraTarget": [-62.181, -50.463, 1.985],
//                        "title": "Pleasures and Perils",
//                        "description": `
//						These figures are nude mythical creations that are half-human and half-fish surrounded by sea motifs such as seaweed and coral. The seated figures are reproductions made in 1982.
//						`
//                    });
//                    sceneSG.annotations.add(aAbout2);
//                }
//
			// Statues         				
                {
                    let aStatues = new Potree.Annotation({
                        position: [-23.590, -23.959, 2.530],
                        title: "Statues",
						cameraPosition: [-23.590, -23.959, 2.530],
                        cameraTarget: [-25.609, -23.231, 1.536],
                        description: `Estas criaturas míticas desnudas con características humanas y pez se encuentran rodeadas de motivos marítimos, como algas marinas y corales. Las figuras sentadas son reproducciones hechas en 1982.`,
                    });
                    aStatues.domElement.off("mouseenter");
                    aStatues.domElement.off("mouseleave");
                    aStatues.addEventListener("click", () => {
                        aStatues.setHighlighted(!aStatues.isHighlighted);
                    });
                    sceneSG.annotations.add(aStatues);
                }
				
				
			// Grotesque         				
                {
                    let Grotesque = new Potree.Annotation({
                        position: [-52.107, -49.002, -2.007],
                        title: "Grotesques",
                        cameraPosition: [-50.295, -51.055, -1.438],
                        cameraTarget: [-67.337, -30.449, -0.615],
                        description: `En arquitectura, el grutesco es un motivo decorativo derivado de la mitología o la fantasía. Un grutesco en el lado oeste está casi completamente desaparecido. Los otros siete grutescos se mantienen intactos.`,
                    });
                    Grotesque.domElement.off("mouseenter");
                    Grotesque.domElement.off("mouseleave");
                    Grotesque.addEventListener("click", () => {
                        Grotesque.setHighlighted(!Grotesque.isHighlighted);
                    });
                    sceneSG.annotations.add(Grotesque);
                }

            // Mermaids
            {
                let Mermaids = new Potree.Annotation({
                    position: [-63.358, -51.438, -1.902],
                    title: "Mermaids",
                    cameraPosition: [-65.596, -53.536, -1.081],
                    cameraTarget: [-44.362, -35.946, -6.132],
                    description: `El clima subtropical y más de un siglo de tormentas han borrado muchos de los detalles de las sirenas que adornan la Barcaza. A través de Vizcaya se encuentran representaciones de la vida marina. Algunas de estas obras se basan en la naturaleza, y otras, como las esculturas de niños tritones en la Fuente del Jardín, son producto de la imaginación.  `,
                });
                Mermaids.domElement.off("mouseenter");
                Mermaids.domElement.off("mouseleave");
                Mermaids.addEventListener("click", () => {
                    Mermaids.setHighlighted(!Mermaids.isHighlighted);
                });
                sceneSG.annotations.add(Mermaids);
            }					
				
            }
        });
			// Herm point cloud in scene 2
			Potree.loadPointCloud("https://s3.amazonaws.com/vizcaya/pointclouds/herm/cloud.js", "herm", function(e){
			
			sceneSG2.addPointCloud(e.pointcloud);
			sceneSG2.view.position.set(40.480, -28.044, 52.055);
			sceneSG2.view.lookAt(new THREE.Vector3(-1.311, -0.328, 41.852));
			e.pointcloud.material.pointSizeType = Potree.PointSizeType.ADAPTIVE;
			
			sceneSG2.addAnnotation([31.570, 1.729, 53.886], {
				"title": "Return to Barge",
				"actions": [{
					"icon": Potree.resourcePath + "/icons/goto-w.svg",
					"onclick": function(){
						viewer.setScene(sceneSG);
					}
				}]
			});
		});
		
		// Pleasures and Perils
		Potree.loadPointCloud("https://s3.amazonaws.com/vizcaya/pointclouds/mermaid/cloud.js", "pleasuresandperils", function(e){
			sceneLion.addPointCloud(e.pointcloud);
			sceneLion.view.position.set(-148.290, 22.164, 56.452);
			sceneLion.view.lookAt(new THREE.Vector3(-16.875, -10.208, 41.394));
			e.pointcloud.material.pointSizeType = Potree.PointSizeType.ADAPTIVE;
			
			sceneLion.addAnnotation([-36.268, -19.210, -15.277], {
				"title": "Return to Barge",
				"actions": [{
					"icon": Potree.resourcePath + "/icons/goto-w.svg",
					"onclick": function(){
						viewer.setScene(sceneSG);
					}
				}]
			});
		});
	</script>
	
	
  </body>
</html>
